@model Cats.Models.ViewModels.UserPreferenceViewModel
@using Kendo.Mvc.UI
@using Cats.Areas.Settings.Models
@using Cats.Models
@{
    ViewBag.Title = "Preference";
    Layout = "~/Views/Shared/NewTheme _MainLayout.cshtml";
    ViewBag.PageTitle = "Preferences";//@Html.Translate((string)@ViewBag.Title);
    ViewBag.PageTitleDescription = "";
}

<style>
    #sortable1, #sortable2, #sortable3 { list-style-type: none; margin: 0; padding: 0; float: left; margin-right: 10px; background: #eee; padding: 5px; width: 143px;}
    #sortable1 li, #sortable2 li, #sortable3 li { margin: 5px; padding: 5px; font-size: 1.2em; width: 120px; cursor: pointer}
    #tabs ul{ background-color: #ececec;-moz-border-radius-topleft: 5px; -moz-border-radius-topright: 5px}

    .unselectedTitle { font-size: 20px;background-color: #ececec;width: 390px;text-align: center;padding: 10px;}

    .selectedTitle { font-size: 20px;background-color: #ececec;width: 390px;text-align: center;padding: 10px; }
</style>
<script src="~/Scripts/jquery-ui.js"></script>
<script>
    $(function () {
        $("ul.droptrue").sortable({
            connectWith: "ul",

        });

        $("ul.dropfalse").sortable({
            connectWith: "ul",
            dropOnEmpty: false
        });
        $("#tabs").tabs();
        $("#sortable1, #sortable2, #sortable3").disableSelection();

    });

    $(".saveChanges").click(function (e) {
        preventDefault();
        saveChanges();
    });
    function saveChanges() {

        var selectedDashboards = new Array();
        var i = 0;
        $('#sortable2 li').each(function (index, obj) {
            selectedDashboards[i] = $(this).attr("id");
            i++;
        });
        $.ajax({
            type: "POST",
            url: "/Home/SavePreference",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(selectedDashboards),
            dataType: "json",
            beforeSend:BeforeSendActivity,
            success: PreferenceSaveCompleted,
            error: PreferenceSaveFailed
        });
    }
    var timer;
    function BeforeSendActivity() {
        //alert();
        //var msg = '<div class="cats_success">Loading...</div>';
        //$(".message-window").html(msg).delay(800).hide().fadeIn();
    }
    function PreferenceSaveCompleted(results) {
        if (results) {
            var msg = '<div class="cats_success">Success: Dashboard preference updated.</div>';
            $(".message-window").html(msg).delay(800).hide().fadeIn();
            clearTimeout(timer);
            timer = setTimeout(function () {
                $(".message-window").fadeOut("normal", function () { $(this).html(''); });
            }, 5000);
        }
    }

    function PreferenceSaveFailed(request, status, error) {
        //var msg = '<div class="cats_error">Error: ' + error + '. Status: ' + status + '</div>';
        var msg = '<div class="cats_error">Error: Dashboard preference not updated.';
        $(".message-window").html(msg).delay(800).hide().fadeIn();
        clearTimeout(timer);
        timer = setTimeout(function () {
            $(".message-window").fadeOut("normal", function () { $(this).html(''); });
        }, 5000);
    }
</script>

<div class="portlet light bordered">
    <div class="portlet-title">
        <div class="caption font-green-haze">
            <i class="icon-edit font-green-haze"></i>
            <span class="caption-subject bold uppercase"> Preference</span>
        </div>
        <div class="actions">
            <a href="JavaScript:" class="btn green" id="save"><i class="fa fa-save"></i> Save</a>
            <a href="JavaScript:" class="btn red" id="cancel"><i class="fa fa-times-circle"></i> Cancel</a>
            <a class="btn btn-icon-only btn-default fullscreen" href="javascript:;" data-original-title="" title=""></a>
        </div>
    </div>
    <div class="portlet-body">
        <div class="tabbable-custom ">
            <ul class="nav nav-tabs ">
                <li class="active">
                    <a href="#general_tab" data-toggle="tab">
                        General
                    </a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane active" id="general_tab">
                    @Html.Partial("Edit", Model)
                </div>
            </div>
        </div>
    </div>
</div>

