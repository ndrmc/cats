@using Cats.Helpers

@{
    ViewBag.Title = "Index";
    const string PAGE_NAME = "EarlyWarning.Index";
    Layout = "~/Views/Shared/NewTheme _MainLayout.cshtml";
    ViewBag.PageTitle = Html.Translate("Regional Dashboard");
    ViewBag.PageTitleDescription = "[ "  + ViewBag.RegionName + " ]";

    #region Data Activity Indicator ViewBags

    //Data Activity Indicator uses ViewBag.PageName to get  Workflows configured for the page
    ViewBag.PageName = Cats.Services.Workflows.Constants.RegionalPage;

    #endregion


}




@section styles
{
    @*<link href="~/Content/Dashboard/dashboardcomponents.css" rel="stylesheet" />*@
    <style type="text/css">
        .flag {
            width: 60px;
            height: 30px;
            background: url("/Content/images/Regionsflags.png") no-repeat;
            border-top-right-radius: 12px;
            border-top-left-radius: 12px;
            border-bottom-right-radius: 12px;
            border-bottom-left-radius: 12px;
            margin: 5px 5px 5px 5px;
        }

        .flag.flag-somali {
            background-position: 0 0;

        }

        .flag.flag-tigray {
            background-position: -60px 0;
        }

        .flag.flag-gambella {
            background-position: -120px 0;
        }

.flag.flag-benishangul {
            background-position: 0 -30px;
        }

.flag.flag-harrar {
            background-position: -60px -30px;
        }

.flag.flag-debub {
            background-position: -120px -30px;
        }

.flag.flag-oromiya {
            background-position: 0 -60px;
        }

.flag.flag-amhara {
            background-position: -60px -60px;
        }

        .flag.flag-afar {
            background-position: -120px -60px;
        }

.flag.flag-federal {
            background-position: 0 -90px;
        }

        .flag.flag-diredawa {
            background-position: -60px -90px;
        }
    </style>
}

<div ng-app="myApp" class="container">
    <div class="row">
        <div class="portlet solid bordered" ng-controller="ImportantNumbersController">
            <div class="portlet-title">
                <div class="caption font-green-sharp">
                    <i class="pull-left {{Flag}}" style="margin-top: -8px;margin-right: 15px;"></i>
                    <span class="caption-subject bold uppercase"> Regional Dashboard for @ViewBag.RegionName</span>

                </div>
            </div>
            <div class="portlet-body">
                <div class="row">
                    <div class="col-md-3 col-sm-6 col-xs-6">
                        <div class="dashboard-stat green-haze">
                            <div class="visual">
                                <i class="fa fa-child"></i>
                            </div>
                            <div class="details">
                                <div class="number" ng-cloak>{{Numbers.TotalRequests|number}}</div>
                                <div class="desc">Total Requests</div>
                            </div><a class="more" href="#">more...</a>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 col-xs-6">
                        <div class="dashboard-stat green-haze">
                            <div class="visual">
                                <i class="fa fa-envelope"></i>
                            </div>
                            <div class="details">
                                <div class="number" ng-cloak>{{Numbers.TotalRequistions|number}}</div>
                                <div class="desc">Total Requistions</div>
                            </div><a class="more" href="#">more...</a>
                        </div>
                    </div>
                 <div class="col-md-3 col-sm-6 col-xs-6">
                        <div class="dashboard-stat green-haze">
                            <div class="visual">
                                <i class="fa fa-institution "></i>
                            </div>
                            <div class="details">
                                <div class="number" ng-cloak>{{Numbers.TotalFDPS|number}}</div>
                                <div class="desc">Total Number of FDPS</div>
                            </div><a class="more" href="#">more...</a>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 col-xs-6">
                        <div class="dashboard-stat green-haze">
                            <div class="visual">
                                <i class="fa fa-users"></i>
                            </div>
                            <div class="details">
                                <div class="number" ng-cloak>{{Numbers.TotalPeople|number}}</div>
                                <div class="desc">Beneficiaries in Current HRD</div>
                            </div><a class="more" href="#">more...</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">

        @Html.Partial("_DataActivityIndicator")
    </div>


        <div ng-controller="RegionalDashboardController" class="container">
            <div class="portlet light bordered bg-inverse" ng-controller="ImportantNumbersController">
                <div class="portlet-title">
                    <div class="caption font-green-sharp">
                        <i class="icon-list font-green-sharp"></i>
                        <span class="caption-subject bold uppercase"> Assesments</span>
                    </div>
                    <div class="tools">
                        <a href="#" class="collapse" data-original-title="" title=""></a>
                    </div>
                    <div class="actions">
                        <a class="btn btn-icon-only btn-default fullscreen"></a>
                    </div>
                </div>

                <div class="portlet-body" id="_RequestContent">
                    <div class="table-responsive">
                        <table id="" class="table table-striped table-checkable">
                            <thead>
                                <tr>
                                    @*<th class="hidden-xs">Plan ID</th>*@
                                    @*<th class="string">Season</th>*@
                                    <th>Assessment Name</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Status</th>
                                    @*<th class="number">Amount(QT)</th>
                                        <th>Status</th>
                                        <th>Detail</th>*@
                                </tr>
                            </thead>
                            <tbody ng-cloak>
                                <tr class="" ng-repeat="assessment in Assesments">
                                    @*<td class="hidden-xs">{{assessment.PlanID}}</td>*@
                                    @*<td class="number">{{assessment.Season}}</td>*@
                                    <td>{{assessment.PlanName}}</td>
                                    <td>{{assessment.StartDate}} </td>
                                    <td>{{assessment.EndDate}} </td>
                                    <td><span class="label label-success">{{assessment.StatusDescription}}</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>

            <div ng-controller="stageController">
                <div class="portlet light bordered">
                    <div class="portlet-title">
                        <div class="caption font-green-sharp">
                            <i class="icon-list font-green-sharp"></i>
                            <span class="caption-subject bold uppercase"> Requests </span>
                        </div>
                        <div class="tools">
                            <a href="#" class="collapse" data-original-title="" title=""></a>
                        </div>
                        <div class="actions">
                            <a class="btn btn-icon-only btn-default fullscreen"></a>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div class="row">
                            <div class="col-md-8 col-sm-12">
                                <div class="portlet solid bordered">
                                    <div class="portlet-title">
                                        <div class="caption font-green-sharp">
                                            @*<i class="icon-speech font-green-sharp"></i>*@
                                            <span class="caption-subject bold uppercase"> Recent Requests </span>
                                        </div>
                                        <div class="tools">
                                            @*<a href="#" class="collapse" data-original-title="" title=""></a>*@
                                        </div>
                                        <div class="actions">
                                            <a class="btn green" onclick="window.location.href = '../EarlyWarning/Request';"><i class="fa fa-list"></i> Show More</a>
                                            <a class="btn green" onclick="window.location.href = '../EarlyWarning/Request/New';"><i class="fa fa-plus"></i> New Request</a>
                                            @*<a class="btn btn-icon-only btn-default fullscreen" href="javascript:;" data-original-title="" title=""></a>*@
                                        </div>
                                    </div>
                                    <div class="portlet-body">
                                        <div class="table-responsive">
                                            <table id="" class="table table-condensed table-striped table-checkable">
                                                <thead>
                                                    <tr>
                                                        <th class="hidden-xs">Number</th>
                                                        <th class="number">FDPS</th>
                                                        <th class="number">Beneficiaries</th>
                                                        <th class="number">Amount(QT)</th>
                                                        <th>Status</th>
                                                        <th>Detail</th>
                                                        @*<th class="align-center">Action</th>*@
                                                    </tr>
                                                </thead>
                                                <tbody ng-cloak>

                                                    <tr class="" ng-repeat="request in Requests">
                                                        <td class="hidden-xs">{{request.RequestNumber}}</td>
                                                        <td class="number">{{request.Month}}</td>
                                                        <td class="number">{{request.Beneficiaries|number}}</td>
                                                        <th class="number">{{request.Amount|number}} QT</th>
                                                        <td>
                                                            <div>
                                                                <span>

                                                                    @*{{request.Status}}*@ Draft
                                                                </span>
                                                            </div>
                                                        </td>
                                                        <th>
                                                            <a ng-click="viewRequest(request)" class="btn default btn-xs green-sharp-stripe">
                                                                View <i class="icon-chevron-right"></i>
                                                            </a>
                                                        </th>

                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 col-sm-12">
                                <div class="portlet solid bordered">
                                    <div class="portlet-title">
                                        <div class="caption font-green-sharp">
                                            @*<i class="icon-speech font-green-sharp"></i>*@
                                            <span class="caption-subject bold uppercase"> Requests Percentage </span>
                                        </div>
                                        <div class="tools">
                                            @*<a href="#" class="collapse" data-original-title="" title=""></a>*@
                                        </div>
                                        <div class="actions">
                                            @*<a class="btn btn-icon-only btn-default fullscreen" href="javascript:;" data-original-title="" title=""></a>*@
                                        </div>
                                    </div>
                                    <div class="portlet-body">
                                        <div id="containerPIE" class="chartWrap" draw-pie-chart=""></div>
                                    </div>
                                </div>

                            </div>

                        </div>

                    </div>
                </div>


                <div class="portlet light bordered bg-inverse">
                    <div class="portlet-title">
                        <div class="caption font-green-sharp">
                            <i class="icon-list font-green-sharp"></i>
                            <span class="caption-subject bold uppercase"> Requisitions </span>
                        </div>

                        <div class="tools">
                            <a href="#" class="collapse" data-original-title="" title=""></a>
                        </div>
                        <div class="actions">
                            <a class="btn btn-icon-only btn-default fullscreen"></a>
                        </div>
                    </div>

                    <div class="portlet-body" id="RequisitionContent">
                        <div class="row">
                            <div class="col-md-8 col-sm-12">
                                <div class="portlet solid bordered">
                                    <div class="portlet-title">
                                        <div class="caption font-green-sharp">
                                            @*<i class="icon-speech font-green-sharp"></i>*@
                                            <span class="caption-subject bold uppercase"> Recent Requisitions </span>
                                        </div>
                                        <div class="tools">
                                            @*<a href="#" class="collapse" data-original-title="" title=""></a>*@
                                        </div>
                                        <div class="actions">
                                            <a class="btn green" onclick="window.location.href = 'RegionRequisitions'"><i class="fa fa-list"></i> Show More</a>
                                            @*<a class="btn btn-icon-only btn-default fullscreen" href="javascript:;" data-original-title="" title=""></a>*@
                                        </div>
                                    </div>
                                    <div class="portlet-body">
                                        <div class="table-responsive">
                                            <table id="" class="table table-striped table-checkable">
                                                <thead>
                                                    <tr>
                                                        <th class="hidden-xs">Number</th>
                                                        <th>Commodity</th>
                                                        <th class="number">Beneficiaries</th>
                                                        <th class="number">Amount(QT)</th>
                                                        <th>Status</th>

                                                    </tr>

                                                </thead>
                                                <tbody ng-cloak>
                                                    <tr class="" ng-repeat="requisition in Requisitions">

                                                        <td>{{requisition.RequisitionNo}}</td>
                                                        <th>{{requisition.Name}}</th>
                                                        <td class="number">{{requisition.BenficiaryNo|number}}</td>
                                                        <th class="number">{{requisition.Amount|number}} QT</th>
                                                        <td><span class="label label-danger">Approved</span></td>

                                                    </tr>

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="col-md-4 col-sm-12">
                                <div class="portlet solid bordered">
                                    <div class="portlet-title">
                                        <div class="caption font-green-sharp">
                                            @*<i class="icon-speech font-green-sharp"></i>*@
                                            <span class="caption-subject bold uppercase"> Requisitions Percentage </span>
                                        </div>
                                        <div class="tools">
                                            @*<a href="#" class="collapse" data-original-title="" title=""></a>*@
                                        </div>
                                        <div class="actions">
                                            @*<a class="btn btn-icon-only btn-default fullscreen" href="javascript:;" data-original-title="" title=""></a>*@
                                        </div>
                                    </div>
                                    <div class="portlet-body">
                                        <div id="_container" class="chartWrap" draw-requisitions-chart=""></div>
                                    </div>
                                </div>

                            </div>

                        </div>

                    </div>
                </div>


                <div class="portlet light bordered">
                    <div class="portlet-title">
                        <div class="caption font-green-sharp">
                            <i class="icon-list font-green-sharp"></i>
                            <span class="caption-subject bold uppercase"> Dispatches </span>
                        </div>

                        <div class="tools">
                            <a href="#" class="collapse" data-original-title="" title=""></a>
                        </div>
                        <div class="actions">
                            <a class="btn btn-icon-only btn-default fullscreen"></a>
                        </div>
                    </div>

                    <div class="portlet-body" id="DispatchContent">
                        <div class="row">
                            <div class="col-md-9 col-sm-12">
                                <div class="portlet solid bordered">
                                    <div class="portlet-title">
                                        <div class="caption font-green-sharp">
                                            @*<i class="icon-speech font-green-sharp"></i>*@
                                            <span class="caption-subject bold uppercase"> Incoming Dispatches </span>
                                        </div>
                                        <div class="tools">
                                            @*<a href="#" class="collapse" data-original-title="" title=""></a>*@
                                        </div>
                                        <div class="actions">
                                            <a class="btn green" href="@Url.Action("Index", "Dispatch", new {Area = "Regional", regionID = ViewBag.RegionID})"><i class="fa fa-list"></i> Show More</a>
                                            <a class="btn green" href="@Url.Action("Index", "DeliveryReconcile", new {Area = "Logistics", regionID = ViewBag.RegionID})"> FDP Commodity Receipt</a>
                                            @*<a class="btn btn-icon-only btn-default fullscreen" href="javascript:;" data-original-title="" title=""></a>*@
                                        </div>
                                    </div>
                                    <div class="portlet-body">
                                        <div class="table-responsive">
                                            <table class="table table-condensed table-striped table-checkable">
                                                <thead>
                                                    <tr>
                                                        <th>FDP</th>
                                                        <th>Woreda</th>
                                                        <th>Commodity</th>
                                                        <th class="number">Quantity(QT)</th>
                                                        <th>Source Hub</th>
                                                        <th>Transporter</th>
                                                        <th>GIN</th>
                                                    </tr>

                                                </thead>
                                                <tbody ng-cloak>
                                                    <tr class="" ng-repeat="dispatch in Dispatches">
                                                        <td>{{dispatch[0].Value}}</td>
                                                        <th>{{dispatch[1].Value}}</th>
                                                        <td>{{dispatch[2].Value}}</td>
                                                        <th class="number">{{dispatch[5].Value|number:2}} QT</th>
                                                        <td>{{dispatch[3].Value}}</td>
                                                        <th>{{dispatch[4].Value}}</th>
                                                        <th>{{dispatch[6].Value}}</th>
                                                    </tr>

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="col-md-3 col-sm-12">
                                <div class="portlet solid bordered">


                                    <div class="portlet-body">
                                        <div class="row">
                                            <div class="col-md-12 col-sm-12 col-xs-12">
                                                <div class="dashboard-stat green-haze">
                                                    <div class="visual">
                                                        <i class="fa fa-truck"></i>
                                                    </div>
                                                    <div class="details">
                                                        <div class="number" ng-cloak>{{Census.IncomingDispatches|number}}</div>
                                                        <div class="desc">Incoming Dispatches</div>
                                                    </div><a class="more" href="#">more...</a>
                                                </div>
                                            </div>
                                            <div class="col-md-12 col-sm-12 col-xs-12">
                                                <div class="dashboard-stat green-haze">
                                                    <div class="visual">
                                                        <i class="fa fa-cubes"></i>
                                                    </div>
                                                    <div class="details">
                                                        <div class="number" ng-cloak>
                                                            {{Census.IncomingCommodity|number}} <i class="cats-unit-pref"></i>
                                                        </div>
                                                        <div class="desc">Total Incoming Commodity</div>
                                                    </div><a class="more" href="#">more...</a>
                                                </div>
                                            </div>


                                        </div>

                                    </div>
                                </div>

                            </div>

                        </div>

                    </div>
                </div>


                <!-- BEGIN DISTRIBUTION -->
                <div class="portlet light bordered bg-inverse">
                    <div class="portlet-title">
                        <div class="caption font-green-sharp">
                            <i class="icon-list font-green-sharp"></i>
                            <span class="caption-subject bold uppercase"> Distribution </span>
                        </div>

                        <div class="tools">
                            <a href="#" class="collapse" data-original-title="" title=""></a>
                        </div>
                        <div class="actions">
                            <a class="btn btn-icon-only btn-default fullscreen"></a>
                        </div>
                    </div>

                    <div class="portlet-body" id="DistributionContent">
                        <div class="row">
                            <div class="col-md-6 col-sm-12">
                                <div class="portlet solid bordered">
                                    <div class="portlet-title">
                                        <div class="caption font-green-sharp">
                                            @*<i class="icon-speech font-green-sharp"></i>*@
                                            <span class="caption-subject bold uppercase"> Current Distributions </span>
                                        </div>
                                        <div class="tools">
                                            @*<a href="#" class="collapse" data-original-title="" title=""></a>*@
                                        </div>
                                        <div class="actions">
                                            <a class="btn green" href="@Url.Action("Index", "WoredaStockDistribution", new {Area = "Logistics", regionID = ViewBag.RegionID})"><i class="fa fa-list"></i> Show More</a>
                                            @*<a class="btn btn-icon-only btn-default fullscreen" href="javascript:;" data-original-title="" title=""></a>*@
                                        </div>
                                    </div>
                                    <div class="portlet-body">
                                        <div class="table-responsive">
                                            <table id="" class="table table-striped table-checkable">
                                                <thead>
                                                    <tr>
                                                        <th class="hidden-xs">Plan</th>
                                                        <th>Woreda</th>
                                                        <th class="number">FDPs</th>
                                                        <th class="align-center"></th>
                                                    </tr>

                                                </thead>
                                                <tbody ng-cloak>
                                                    <tr class="" ng-repeat="Distribution in Distribtion">
                                                        <td>{{Distribution.plan}}</td>
                                                        <th>{{Distribution.Woreda}}</th>
                                                        <th>{{Distribution.Fdps}}</th>

                                                    </tr>

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="col-md-4 col-sm-12">
                                <div class="portlet solid bordered">
                                    <div class="portlet-title">
                                        <div class="caption font-green-sharp">
                                            @*<i class="icon-speech font-green-sharp"></i>*@
                                            <span class="caption-subject bold uppercase"> Age Percentage </span>
                                            <span class="caption-helper" ng-cloak> Current HRD:{{Census.AgeGroupPlanName}}</span>
                                        </div>

                                        <div class="tools">
                                            @*<a href="#" class="collapse" data-original-title="" title=""></a>*@
                                        </div>

                                        <div class="actions">
                                            @*<a class="btn btn-icon-only btn-default fullscreen" href="javascript:;" data-original-title="" title=""></a>*@
                                        </div>

                                    </div>
                                    <div class="portlet-body">
                                        <div id="Age" class="chartWrap" draw-age-chart></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 col-sm-12">
                                <div class="portlet solid bordered">
                                    <div class="portlet-body">
                                        <div class="row">
                                            <div class="col-md-12 col-sm-12 col-xs-12">
                                                <div class="dashboard-stat green-haze">
                                                    <div class="visual">
                                                        <i class="fa fa-female"></i>
                                                    </div>
                                                    <div class="details">
                                                        <div class="number" ng-cloak>{{Census.Female|number}}</div>
                                                        <div class="desc">Female</div>
                                                    </div><a class="more" href="#"></a>
                                                </div>
                                            </div>
                                            <div class="col-md-12 col-sm-12 col-xs-12">
                                                <div class="dashboard-stat green-haze">
                                                    <div class="visual">
                                                        <i class="fa fa-male"></i>
                                                    </div>
                                                    <div class="details">
                                                        <div class="number" ng-cloak>
                                                            {{Census.Male|number}}
                                                        </div>
                                                        <div class="desc">Male</div>
                                                    </div><a class="more" href="#"></a>
                                                </div>
                                            </div>
                                            <div class="col-md-12 col-sm-12 col-xs-12">
                                                <div class="dashboard-stat green-haze">
                                                    <div class="visual">
                                                        <i class="fa fa-users"></i>
                                                    </div>
                                                    <div class="details">
                                                        <div class="number" ng-cloak>
                                                            {{Census.Male+Census.Female|number}}
                                                        </div>
                                                        <div class="desc">Total</div>
                                                    </div><a class="more" href="#"></a>
                                                </div>
                                            </div>


                                        </div>

                                    </div>
                                </div>

                            </div>

                        </div>

                    </div>
                </div>
                <!-- END DISTRIBUTION -->

            </div>


            <!-- Begin Allocation Changes -->
            <div class="portlet light bordered">
                <div class="portlet-title">
                    <div class="caption font-green-sharp">
                        <i class="icon-list font-green-sharp"></i>
                        <span class="caption-subject bold uppercase"> Allocation Changes</span>
                        <span class="caption-helper"> Recent Allocation Changes</span>
                    </div>

                    <div class="tools">
                        <a href="#" class="collapse" data-original-title="" title=""></a>
                    </div>
                    <div class="actions">
                        <a class="btn btn-icon-only btn-default fullscreen"></a>
                    </div>
                </div>

                <div class="portlet-body" id="AllocationChangeContent">
                    <div class="table-responsive">
                        <table id="" class="table table-condensed table-striped table-checkable">
                            <thead>
                                <tr>
                                    <th class="hidden-xs">Number</th>
                                    <th class="number">FDPS</th>
                                    <th class="number">Beneficiaries</th>
                                    <th class="number">Requested Amount(QT)</th>
                                    <th class="number">Allocated Amount(QT)</th>
                                    @*<th class="align-center">Action</th>*@
                                </tr>
                            </thead>
                            <tbody ng-cloak>


                                <tr class="" ng-repeat="allocationChange in AllocationChanges">
                                    <td class="hidden-xs">{{allocationChange.RequestNumber}}</td>
                                    <td class="number">{{allocationChange.Month}}</td>
                                    <td class="number">{{allocationChange.Beneficiaries|number}}</td>
                                    <th class="number">{{allocationChange.RequestedAmount|number}} QT</th>
                                    <th class="number">{{allocationChange.AllocatedAmount|number}} QT</th>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- End Allocation Changes -->

        </div>
    </div>

<script>
    $("#RequestHeader").click(function () {
        $("#RequestContent").slideToggle("slow", "linear");
    });

    $("#RequisitionHeader").click(function () {
        $("#RequisitionContent").slideToggle("slow", "linear");
    });

    $("#AllocationChangeHeader").click(function () {
        $("#AllocationChangeContent").slideToggle("slow", "linear");
    });

    $("#DispatchHeader").click(function () {
        $("#DispatchContent").slideToggle("slow", "linear");
    });

    $("#DistributionHeader").click(function () {
        $("#DistributionContent").slideToggle("slow", "linear");
    });
</script>

<script>
    function RegionalDashboardController($scope, $http) {

        $scope.reqParam = { regionID: '@ViewBag.RegionID' };
        $scope.Requests = [];
        $scope.Requisitions = [];
        $scope.AllocationChanges = [];
        $scope.Dispatches = [];
        $scope.Data = [];
        $scope.Distribtion = [];
        $scope.Assesments = [];


        var onRequestsSuccess = function (data) {
            $scope.Requests = data;
        };

        var onRequisitionsSuccess = function (data) {
            $scope.Requisitions = data;
        };

        var onAllocationChangesSuccess = function (data) {
            $scope.AllocationChanges = data;
        };

        var onDispatchesSuccess = function (data) {
            $scope.Dispatches = data;
        };
        var onDistributionSuccess = function (data) {
            $scope.Distribtion = data;
        };
        var onDashboardDataSuccess = function (data) {
            $scope.Data = data;
        };

        var onAssesmentDataSuccess = function (data) {
            $scope.Assesments = data;
        };

        $scope.getRequests = function () {
            $http.post("@Url.Action("Requests", "FetchData", new { Area = "Regional" })", $scope.reqParam).success(onRequestsSuccess);
        };

        $scope.getRequisitions = function () {
            $http.post("@Url.Action("Requisitions", "FetchData", new { Area = "Regional" })", $scope.reqParam).success(onRequisitionsSuccess);
        };

        $scope.getAllocationChanges = function () {
            $http.post("@Url.Action("AllocationChanges", "FetchData", new { Area = "Regional" })", $scope.reqParam).success(onAllocationChangesSuccess);
        };

        $scope.getDispatches = function () {
            $http.post("@Url.Action("Dispatches", "FetchData", new { Area = "Regional" })", $scope.reqParam).success(onDispatchesSuccess);
        };

        $scope.getDistribution = function () {
            $http.post("@Url.Action("Distributions", "FetchData", new { Area = "Regional" })", $scope.reqParam).success(onDistributionSuccess);
        };

        @*$scope.getRegionalData = function () {
            $http.post("@Url.Action("RegionalData", "FetchData", new { Area = "Regional" })", $scope.reqParam).success(onDashboardDataSuccess);
        };*@
        $scope.getRegionalData = function () {
            $http.post("@Url.Action("RegionalData", "FetchData", new { Area = "Regional" })", $scope.reqParam).success(onDashboardDataSuccess);
        };
        $scope.viewRequistion = function (item) {
            window.location = "@Url.Action("Allocation","ReliefRequisition",new {Area="EarlyWarning"})" + "?id=" + +item.RequisitionID;
        };

        $scope.viewRequest = function (item) {
            window.location = "@Url.Action("Details","Request",new {Area="EarlyWarning"})" + "?id=" + +item.RegionalRequestID;
         };

        $scope.getAssesments = function () {
            $http.post("@Url.Action("Assesments", "FetchData", new { Area = "Regional" })", $scope.reqParam).success(onAssesmentDataSuccess);
        };

        $scope.getRequests();
        $scope.getRequisitions();
        $scope.getAllocationChanges();
        $scope.getDispatches();
        //$scope.getRegionalData();
        $scope.getDistribution();
        $scope.getAssesments();
    }


    function ImportantNumbersController($scope, $http) {
        $scope.reqParam = { regionID: "@ViewBag.RegionID" };
        $scope.Numbers = [];
        $scope.Flag;

        var regionFlags = [
                               "flag flag-federal",
                               "flag flag-afar",
                               "flag flag-amhara",
                               "flag flag-benishangul",
                               "flag flag-tigray",
                               "flag flag-diredawa",
                               "flag flag-gambella",
                               "flag flag-harar",
                               "flag flag-oromiya",
                               "flag flag-debub",
                               "flag flag-somali"
        ];

        var onNumbersSuccess = function (data) {
            $scope.Numbers = data;
            $scope.Flag = regionFlags['@ViewBag.RegionID' - 1];
            //alert($scope.Flag)
        };

        $scope.getNumbers = function () {
            $http.post("@Url.Action("ImportantNumbers", "FetchData", new { Area = "Regional" })", $scope.reqParam).success(onNumbersSuccess);
        };

        $scope.getNumbers();
    }

</script>

<script>
    'use strict';

    // Declare app level module which depends on filters, and services
    angular.module('myApp', ['myApp.directives', 'DataEntryIndicatorApp']);

    /* Controllers */
    function stageController($scope, $http) {
        $scope.type = 'Requests Percentage';
        $scope.Census = [];
        var onDashboardDataSuccess = function(d) {

            //$scope.data = [
            //    ['Hub Assigned', d["HubAssignedRequests"]],
            //    ['Pending', d["PendingRequests"]],
            //    ['Approved', d["ApprovedRequests"]],
            //    ['Federal Approved', d["FederalApproved"]]
            //];

            $scope.Census = d;

            $scope.dataRequisition = [
                ['Assigned', d["HubAssignedRequisitions"]],
                ['Pending', d["PendingRequisitions"]],
                ['Approved', d["ApprovedRequisitions"]]
            ];

            $scope.age = [
                ['Older than 18', d["Above18"]],
                ['Between 5 and 8', d["Bet5And8"]],
                ['Younger than 5', d["Below5"]]
            ];

        };
        $scope.initData = function() {
            $http.post("@Url.Action("RegionalData", "FetchData", new {Area = "Regional"})", $scope.reqParam).success(onDashboardDataSuccess);
        };
        $scope.initData();
    }

    function FixChangeController($scope, $http) {
        $scope.type = 'Requests Percentage';
        $scope.RegionalData = [];
        $scope.reqParam = { regionID: '@ViewBag.RegionID' };
        $scope.Requests = [];
        $scope.Requisitions = [];
        $scope.AllocationChanges = [];
        $scope.Dispatches = [];
        $scope.Data = [];
        $scope.Distribtion = [];
        $scope.Assesments = [];

        var onDashboardDataSuccess = function(d) {

            $scope.data = [
                ['Hub Assigned', d["HubAssignedRequests"]],
                ['Pending', d["PendingRequests"]],
                ['Approved', d["ApprovedRequests"]],
                ['Federal Approved', d["FederalApproved"]]
            ];

            $scope.dataRequisition = [
                ['Assigned', d["HubAssignedRequisitions"]],
                ['Pending', d["PendingRequisitions"]],
                ['Approved', d["ApprovedRequisitions"]]
            ];

            $scope.age = [
                ['Older than 18', d["Above18"]],
                ['Between 5 and 8', d["Bet5And8"]],
                ['Younger than 5', d["Below5"]]
            ];

        };
        $scope.initData = function() {
            $http.post("@Url.Action("RegionalData", "FetchData", new {Area = "Regional"})", $scope.reqParam).success(onDashboardDataSuccess);
        };
        $scope.initData();
    }

    /* Directives */

    angular.module('myApp.directives', []).
    directive('drawRequisitionsChart', function() {
            // return the directive link function. (compile function not needed)
            return function(scope, element, attrs) {

                var container = $(element).attr("id");
                // watch the expression, and update the UI on change.
                scope.$watch('dataRequisition', function() {
                    drawPlot();
                }, true);

            var drawPlot = function() {
                    var chart;
                    chart = new Highcharts.Chart({
                        chart: {
                            backgroundColor: '#F5F5F5',
                            renderTo: container
                        },
                        credits: {
                            enabled: false
                        },
                        title: {
                            text: ''
                        },
                        exporting: {
                            enabled: false
                        },
                        tooltip: {
                            pointFormat: '{series.name}: <b>{point.percentage:.2f}</b>%<b> ({point.y})</b> requisitions ',
                            percentageDecimals: 1
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    enabled: false
                                },
                                showInLegend: true
                            }
                        },
                        series: [
                            {
                                type: 'pie',
                                name: 'Percentage',
                                data: scope.dataRequisition
                            }
                        ]
                    });
                }
            }
        });

    angular.module('myApp.directives').

        directive('drawPieChart', function() {
            // return the directive link function. (compile function not needed)
            return function(scope, element, attrs) {
                var container = $(element).attr("id");
                // watch the expression, and update the UI on change.
                scope.$watch('data', function() {
                    drawPlot();
                }, true);
                var drawPlot = function() {
                    var chart;
                    chart = new Highcharts.Chart({
                        chart: {
                            renderTo: container
                        },
                        credits: {
                            enabled: false
                        },
                        title: {
                            text: ''
                        },
                        exporting: {
                            enabled: false
                        },
                        tooltip: {
                            pointFormat: '{series.name}: <b>{point.percentage}</b>% <b>({point.y})</b> Requests',
                            percentageDecimals: 1
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    enabled: false
                                },
                                showInLegend: true
                            }
                        },
                        series: [
                            {
                                type: 'pie',
                                name: 'Percentage',
                                data: [
                                    ['Afar', 25.0],
                                    ['Oromiya', 20.0],
                                    ['Amhara', 40.0],
                                    ['Somali', 5.0],
                                    ['Benishangul', 10.0]
                                ]
                            }
                        ]

                    });
                }
            }

        });

    angular.module('myApp.directives').

        directive('drawAgeChart', function() {
            // return the directive link function. (compile function not needed)
            return function(scope, element, attrs) {
                var container = $(element).attr("id");
                // watch the expression, and update the UI on change.
                scope.$watch('age', function() {
                    drawPlot();
                }, true);
                var drawPlot = function() {
                    var chart;
                    chart = new Highcharts.Chart({
                        chart: {
                            backgroundColor: '#F5F5F5',
                            renderTo: container
                        },
                        credits: {
                            enabled: false
                        },
                        title: {
                            text: ''
                        },
                        exporting: {
                            enabled: false
                        },
                        tooltip: {
                            pointFormat: '{series.name}: <b>{point.percentage:.2f}%</b> ({point.y}) people',
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    enabled: false
                                },
                                showInLegend: true
                            }
                        },
                        series: [
                            {
                                type: 'pie',
                                name: 'Age Percentage',
                                data: scope.age
                            }
                        ]
                    });
                }
            }
        });
</script>

<style type="text/css">
    i.flag {
            margin-top: -8px;
            margin-right: 15px;
        }
</style>

<script src="~/Scripts/js/DataActivityIndictor/DataActivityIndicator.JS"></script>
